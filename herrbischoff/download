#!/usr/bin/env bash

cd "$(dirname $0)"

curl -SfL --no-progress-meter --compressed https://ipbl.herrbischoff.com/badasn.txt -o badasn.ipv4
curl -SfL --no-progress-meter --compressed https://ipbl.herrbischoff.com/ai.txt -o ai.ipv4
curl -SfL --no-progress-meter --compressed https://ipbl.herrbischoff.com/list.txt -o ipblock.ipv4
curl -SfL --no-progress-meter --compressed https://ipbl.herrbischoff.com/tor.txt -o tor.ipv4

cat ipblock.ipv4 | grepip | iprange -1 | sponge ipblock.ipv4
cat badasn.ipv4 | grepip | iprange | sponge ipblock.ipv4

xargs -P4 -n 1 curl -SfL --no-progress-meter --compressed -O < urls.txt

mkdir -p countries

mv *.netset countries/ &> /dev/null
fd .netset -x mv '{}' '{.}'.ipv4
